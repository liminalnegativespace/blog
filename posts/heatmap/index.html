<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="给博客添加heatmap"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://blog.liminalnegativespace.xyz/posts/heatmap/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-14T00:00:00+00:00"><title>给博客添加heatmap | Liminal Negative Space</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.7baeb80339d72f3e753e1a0285405d5f929de3d9cfba21608602efb527dd8bf7.css integrity="sha256-e664AznXLz51PhoChUBdX5Kd49nPuiFghgLvtSfdi/c=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.12155f399b6a6f8eebd387b584ea9606b05bf3325d73580328ff2367c38c3f05.js integrity="sha256-EhVfOZtqb47r04e1hOqWBrBb8zJdc1gDKP8jZ8OMPwU=" crossorigin=anonymous></script><meta property="og:title" content="给博客添加heatmap"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://blog.liminalnegativespace.xyz/posts/heatmap/"><meta property="og:image" content="https://blog.liminalnegativespace.xyz/posts/heatmap/images/header.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-14T00:00:00+00:00"><link rel=alternate type=application/rss+xml href=https://blog.liminalnegativespace.xyz//index.xml title="Liminal Negative Space"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Liminal Negative Space</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/posts/>随便写写</a><br></li><li><a href=/docs/about/>初次见面</a><br></li><li><a href=/docs/friends/>友情链接</a><br></li><li><a href=/docs/notes/>随手记录</a><br></li><li><a href=https://liminalnegativespace.github.io/portfolio>乱涂乱画</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>给博客添加heatmap</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1><a href=/posts/heatmap/>给博客添加heatmap</a></h1><h5>January 14, 2024</h5><figcaption>本文共949字，阅读约需要2分钟</figcaption><div class=taxonomy-container><span class=categories><a href=/categories/%E6%95%85%E7%BA%B8%E5%A0%86/>故纸堆</a></span></div><div class=taxonomy-container><span class=tags><a href=/tags/%E6%8A%80%E6%9C%AF/>技术</a>
</span><span class=taxonomy-sep>/</span>
<span class=tags><a href=/tags/%E6%95%99%E7%A8%8B/>教程</a></span></div><p><img src=/posts/heatmap/images/header.png></p><blockquote class="book-hint info">感谢<a href=https://blog.douchi.space/hugo-blog-heatmap>椒盐豆豉的教程</a></blockquote><p>因为我想要在鼠标移动到某个日期的时候显示所有在这一天发布的文章链接（虽然目前为止还没有在同一天发布超过一篇文章···），于是对代码进行了一些改动。</p><p>要实现这个功能就需要将某个特定日期下发布的所有文章放进一个array里，与当日的总字数一起储存在由日期作为key的map里面：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>var postsByDate = new Map();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>range</span> <span style=color:#f92672>((</span><span style=color:#a6e22e>where</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Site</span><span style=color:#f92672>.</span><span style=color:#a6e22e>RegularPages</span> <span style=color:#e6db74>&#34;Type&#34;</span> <span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>))</span>  <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span>    var date = <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Date</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Format</span> <span style=color:#e6db74>&#34;2006-01-02&#34;</span> <span style=color:#75715e>}}</span>;
</span></span><span style=display:flex><span>    var postObj = new Map();
</span></span><span style=display:flex><span>    postObj.set(&#34;title&#34;, <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Title</span> <span style=color:#75715e>}}</span>);
</span></span><span style=display:flex><span>    postObj.set(&#34;link&#34;, <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>RelPermalink</span> <span style=color:#75715e>}}</span>);
</span></span><span style=display:flex><span>    var wordCount = <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>WordCount</span> <span style=color:#75715e>}}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var data = postsByDate.get(date);
</span></span><span style=display:flex><span>    if (data === undefined) <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>new</span> <span style=color:#a6e22e>Map</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>[]);</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;totalWordCount&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>    var posts = data.get(&#34;posts&#34;);
</span></span><span style=display:flex><span>    posts.push(postObj);
</span></span><span style=display:flex><span>    var totalWordCount = data.get(&#34;totalWordCount&#34;);
</span></span><span style=display:flex><span>    totalWordCount += wordCount;
</span></span><span style=display:flex><span>    data.set(&#34;totalWordCount&#34;, totalWordCount);
</span></span><span style=display:flex><span>    postsByDate.set(date, data);
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span><span style=color:#f92672>-</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span><span style=color:#75715e>}}</span>
</span></span></code></pre></div><p>上面的代码执行完以后<code>postsByDate</code>的数据结构会变成类似下面这个样子：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span><span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2022-10-13&#39;</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;posts&#39;</span><span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>{</span><span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;一篇文章&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;link&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;posts/some-post&#39;</span><span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>{</span><span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;另一篇文章&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;link&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;posts/another-post&#39;</span><span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;totalWordCount&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>404</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2022-11-24&#39;</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;posts&#39;</span><span style=color:#f92672>:</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>{</span><span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;又一篇文章&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;link&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;posts/one-more-post&#39;</span><span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;totalWordCount&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>401</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span></code></pre></div><p>接下来需要改动<code>option</code>中<code>tooltip</code>上的<code>formatter</code>这个attribute来使其显示当日的所有文章链接。前面已经把文章array储存在<code>postsByDate</code>里了，这里只需要从传入的参数里提取出对应的<code>date</code>再以此为key从<code>postsByDate</code>里获取文章信息（关于参数的结构可以参见<a href=https://echarts.apache.org/zh/option.html#tooltip.formatter target=_blank>官方文档</a>）。这里可以直接返回构建好的html string：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>function(params) <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>const</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>postsByDate</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#a6e22e>date</span><span style=color:#f92672>).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>`$</span><span style=color:#75715e>{</span><span style=color:#a6e22e>date</span><span style=color:#75715e>}</span><span style=color:#960050;background-color:#1e0010>`</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>for</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>const</span> <span style=color:#f92672>[</span><span style=color:#a6e22e>i</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>posts</span><span style=color:#f92672>.</span><span style=color:#a6e22e>entries</span><span style=color:#f92672>())</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>content</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>link</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;link&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;title&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>content</span> <span style=color:#f92672>+=</span> <span style=color:#960050;background-color:#1e0010>`</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;${link}&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#75715e>{</span><span style=color:#a6e22e>title</span><span style=color:#75715e>}</span><span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>a</span><span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>return</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>}</span>
</span></span></code></pre></div><div class=book-expand><label><div class="book-expand-head flex justify-between"><span>完整代码</span>
<span>↕</span></div><input type=checkbox class=hidden><div class="book-expand-content markdown-inner"><p><code>layouts/partials/heatmap.html</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>&lt;div 
</span></span><span style=display:flex><span>    id=&#34;heatmap&#34; 
</span></span><span style=display:flex><span>    style=&#34;
</span></span><span style=display:flex><span>    display: block;
</span></span><span style=display:flex><span>    height: 150px;
</span></span><span style=display:flex><span>    width: 75%;
</span></span><span style=display:flex><span>    padding: 2px;
</span></span><span style=display:flex><span>    text-align: center;&#34;
</span></span><span style=display:flex><span>&gt;&lt;/div&gt;
</span></span><span style=display:flex><span>&lt;script src=&#34;https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js&#34;&gt;&lt;/script&gt;
</span></span><span style=display:flex><span>&lt;script type=&#34;text/javascript&#34;&gt;
</span></span><span style=display:flex><span>    var chartDom = document.getElementById(&#39;heatmap&#39;);
</span></span><span style=display:flex><span>    var myChart = echarts.init(chartDom);
</span></span><span style=display:flex><span>    window.onresize = function() <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>myChart</span><span style=color:#f92672>.</span><span style=color:#a6e22e>resize</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>;
</span></span><span style=display:flex><span>    var option;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    // get date range by number of months
</span></span><span style=display:flex><span>    function getDateRange(months)<span style=color:#75715e>{</span>            
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>startDate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>new</span> <span style=color:#a6e22e>Date</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>mill</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>startDate</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setMonth</span><span style=color:#f92672>((</span><span style=color:#a6e22e>startDate</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getMonth</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>months</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>endDate</span> <span style=color:#f92672>=</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>new</span> <span style=color:#a6e22e>Date</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>startDate</span> <span style=color:#f92672>=</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>new</span> <span style=color:#a6e22e>Date</span><span style=color:#f92672>(</span><span style=color:#a6e22e>mill</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>endDate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>echarts</span><span style=color:#f92672>.</span><span style=color:#a6e22e>format</span><span style=color:#f92672>.</span><span style=color:#a6e22e>formatTime</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;yyyy-MM-dd&#39;</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>endDate</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>startDate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>echarts</span><span style=color:#f92672>.</span><span style=color:#a6e22e>format</span><span style=color:#f92672>.</span><span style=color:#a6e22e>formatTime</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;yyyy-MM-dd&#39;</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>startDate</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>dateRange</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[];</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>dateRange</span><span style=color:#f92672>.</span><span style=color:#a6e22e>push</span><span style=color:#f92672>([</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>startDate</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>endDate</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]);</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>return</span> <span style=color:#a6e22e>dateRange</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    // get number of months by window size
</span></span><span style=display:flex><span>    function getMonthCount()<span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>const</span> <span style=color:#a6e22e>windowWidth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>window</span><span style=color:#f92672>.</span><span style=color:#a6e22e>innerWidth</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>if</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>windowWidth</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>600</span><span style=color:#f92672>)</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>return</span> <span style=color:#ae81ff>12</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>if</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>windowWidth</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>400</span><span style=color:#f92672>)</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>return</span> <span style=color:#ae81ff>9</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>return</span> <span style=color:#ae81ff>6</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var postsByDate = new Map();
</span></span><span style=display:flex><span>    <span style=color:#75715e>{{</span> <span style=color:#a6e22e>range</span> <span style=color:#f92672>((</span><span style=color:#a6e22e>where</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Site</span><span style=color:#f92672>.</span><span style=color:#a6e22e>RegularPages</span> <span style=color:#e6db74>&#34;Type&#34;</span> <span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>))</span>  <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        var date = <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Date</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Format</span> <span style=color:#e6db74>&#34;2006-01-02&#34;</span> <span style=color:#75715e>}}</span>;
</span></span><span style=display:flex><span>        var postObj = new Map();
</span></span><span style=display:flex><span>        postObj.set(&#34;title&#34;, <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>Title</span> <span style=color:#75715e>}}</span>);
</span></span><span style=display:flex><span>        postObj.set(&#34;link&#34;, <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>RelPermalink</span> <span style=color:#75715e>}}</span>);
</span></span><span style=display:flex><span>        var wordCount = <span style=color:#75715e>{{</span> <span style=color:#f92672>.</span><span style=color:#a6e22e>WordCount</span> <span style=color:#75715e>}}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        var data = postsByDate.get(date);
</span></span><span style=display:flex><span>        if (data === undefined) <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>new</span> <span style=color:#a6e22e>Map</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>[]);</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;totalWordCount&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>        var posts = data.get(&#34;posts&#34;);
</span></span><span style=display:flex><span>        posts.push(postObj);
</span></span><span style=display:flex><span>        var totalWordCount = data.get(&#34;totalWordCount&#34;);
</span></span><span style=display:flex><span>        totalWordCount += wordCount;
</span></span><span style=display:flex><span>        data.set(&#34;totalWordCount&#34;, totalWordCount);
</span></span><span style=display:flex><span>        postsByDate.set(date, data);
</span></span><span style=display:flex><span>    <span style=color:#75715e>{{</span><span style=color:#f92672>-</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span><span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var heatmapData = [];
</span></span><span style=display:flex><span>    for (const [date, data] of postsByDate.entries()) <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>heatmapData</span><span style=color:#f92672>.</span><span style=color:#a6e22e>push</span><span style=color:#f92672>([</span><span style=color:#a6e22e>date</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>data</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;totalWordCount&#34;</span><span style=color:#f92672>)]);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    option = <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>show</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>top</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>left</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;文章日历&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>legend</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>show</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>visualMap</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>show</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>min</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>max</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10000</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;piecewise&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>showLable</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>orient</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;horizontal&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>left</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>top</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>itemGap</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>inRange</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;#c4e8ff&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;#47b4fc&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;#0269ad&#39;</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>calendar</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>top</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>50</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>left</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>right</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cellSize</span><span style=color:#f92672>:</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;auto&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;auto&#39;</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>range</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>getDateRange</span><span style=color:#f92672>(</span><span style=color:#a6e22e>getMonthCount</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>itemStyle</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#fff&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>borderWidth</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.5</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>borderColor</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#eee&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>yearLabel</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span> 
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>show</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>dayLabel</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>align</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>nameMap</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ZH&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>monthLabel</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>nameMap</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;EN&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>splitLine</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>show</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tooltip</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>hideDelay</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>enterable</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>formatter</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>function</span><span style=color:#f92672>(</span><span style=color:#a6e22e>params</span><span style=color:#f92672>)</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>const</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>postsByDate</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#a6e22e>date</span><span style=color:#f92672>).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;posts&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>`$</span><span style=color:#75715e>{</span><span style=color:#a6e22e>date</span><span style=color:#75715e>}</span><span style=color:#960050;background-color:#1e0010>`</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>for</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>const</span> <span style=color:#f92672>[</span><span style=color:#a6e22e>i</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>posts</span><span style=color:#f92672>.</span><span style=color:#a6e22e>entries</span><span style=color:#f92672>())</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>content</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>link</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;link&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>var</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>post</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;title&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>content</span> <span style=color:#f92672>+=</span> <span style=color:#960050;background-color:#1e0010>`</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;${link}&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#75715e>{</span><span style=color:#a6e22e>title</span><span style=color:#75715e>}</span><span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>a</span><span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>return</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>series</span><span style=color:#f92672>:</span> <span style=color:#75715e>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;heatmap&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>coordinateSystem</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;calendar&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>heatmapData</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>}</span>;
</span></span><span style=display:flex><span>option &amp;&amp; myChart.setOption(option);
</span></span><span style=display:flex><span>&lt;/script&gt;
</span></span></code></pre></div><p><code>在其他页面中插入heatmap</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>partial</span> <span style=color:#e6db74>&#34;heatmap&#34;</span> <span style=color:#f92672>.</span> <span style=color:#75715e>}}</span>
</span></span></code></pre></div></div></label></div><nav class=paginav><a class=prev href=https://blog.liminalnegativespace.xyz/posts/rhino/><span class=title>← prev</span><br><span>犀牛</span>
</a><a class=next href=https://blog.liminalnegativespace.xyz/posts/selling-art/><span class=title>next →</span><br><span>卖画记</span></a></nav></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><footer id=footer><div><span>© 2023 <a href=https://blog.liminalnegativespace.xyz/>Liminal Negative Space</a></span>
•
<span><a href=https://blog.liminalnegativespace.xyz/posts/index.xml target=_blank>RSS</a>
</span>•
<span>Powered by
<a href=https://gohugo.io/ target=_blank>Hugo</a> &
<a href=https://themes.gohugo.io/themes/hugo-book/ target=_blank>Book</a></span></div></footer></footer><div class=book-comments><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://liminal-negative-space.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>